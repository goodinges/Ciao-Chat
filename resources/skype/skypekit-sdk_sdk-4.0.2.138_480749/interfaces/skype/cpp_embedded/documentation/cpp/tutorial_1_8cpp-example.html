<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SkypeKit C++ Wrapper Reference: tutorial_1.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="islander3.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>tutorial_1.cpp</h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="Step1"></a>
C++ Tutorial Step 1: Subclassing and Login</h2>
<p>Let's start with the most basic <a class="el" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a> functions: login and logout.</p>
<p>In this exercise, we'll examine a program that </p>
<ul>
<li>Takes a username and password as command-line arguments </li>
<li>Initiates login with that username </li>
<li>Waits until the login process is complete </li>
<li>Waits for user to press Enter and initiates logout </li>
<li>Waits until logout is complete </li>
<li>Cleans up and exits</li>
</ul>
<h3><a class="anchor" id="Step1Walkthrough"></a>
Code Walkthrough</h3>
<p>First, our program will need to instantiate two objects: </p>
<ul>
<li>skype, which encapsulates the main skype functionality for your user interface. </li>
<li>account, which encapsulates local user account.</li>
</ul>
<div class="fragment"><pre class="fragment">skype = <span class="keyword">new</span> <a name="_a0"></a><a class="code" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a>();
getKeyPair();
skype-&gt;init(keyBuf, inetAddr, portNum, <span class="stringliteral">&quot;streamlog.txt&quot;</span>);
skype-&gt;start();
</pre></div><p>Note that this code assumes the SkypeKit Runtime is ALREADY running. It doesn't launch the runtime automatically.</p>
<p>The getKeyPair() function will load a valid key pair from keypair.pem file into keyBuf array. The loader function comes from the keypair.h (cpp/tutorials/keypair) and assumes the pem file is downloaded to the same directory. In production applications, you will need to replace this loading mechanism with some alternative - as you do not want your developer key to be distributed as a plain text file together with your application. Essentially, you will need to embed and obfuscate the keypair string inside your application.</p>
<p>skype-&gt;start() will start the skype event loop in its own thread. (Note to SkyHost developers: This means that, unlike with SkyHost, you no longer need to check for events in your own UI thread.)</p>
<p>Now our skype object is connected to the SkypeKit Runtime. Next, we'll need an account. For purposes of this example, we'll skip account creation and assume that the username and password we received as command-line arguments are valid for an existing account.</p>
<div class="fragment"><pre class="fragment">MyAccount::Ref account;
skype-&gt;GetAccount(accountName, account)
</pre></div><p>MyAccount is a class derived from <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>. (More about this later.) MyAccount::Ref is a typedef for smart pointers to an Account-derived object. Basically, these two statements:</p>
<div class="fragment"><pre class="fragment">MyAccount * account;
MyAccount::Ref account;
</pre></div><p>are sort of the same thing. The benefit of using smart pointers is in enabling the wrapper to do decent memory management. The wrapper objects are often generated in a rather unpredictable manner - think of incoming chat messages for example. Keeping track of all the instances of all the classes and then deleting them as they become obsolete would be quite a chore. Smart pointers relieve us from that.</p>
<p>However, there is a small cost to using smart pointers. Namely, we can only have one level of inheritance from the base <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a> class. That is, we can derive MyAccount from <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>, but not MyMyAccount from MyAccount. We can still derive MyAccountTypeA and MyAccountTypeB, as long as they are both derived from <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>.</p>
<p>Usage-wise the smart pointer is exactly the same as s normal pointer. We can access all the methods inherited from <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>, as usual: </p>
<div class="fragment"><pre class="fragment">MyAccount::Ref account;
account-&gt;LoginWithPassword();
</pre></div><p>However, to use methods added in your own custom class (in this case MyAccount), we will need to add this line to the public section of your class definition:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>MyAccount : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>
{
<span class="keyword">public</span>:
  <span class="keyword">typedef</span> DRef&lt;MyAccount, Account&gt; Ref;
};
</pre></div><p>Otherwise, if your MyAccount class has a custom method MyCustomLogin</p>
<div class="fragment"><pre class="fragment"><a name="_a2"></a><a class="code" href="class_account_ref.html" title="Reference to an Account class instance, equivalent to Account::Ref.">Account::Ref</a> account;
account-&gt;MyCustomLogin();
</pre></div><p>..would not work. This, however works just fine:</p>
<div class="fragment"><pre class="fragment">MyAccount::Ref account;
account-&gt;MyCustomLogin();
</pre></div><p>Now, it is perhaps not the case with <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a> class in particular, but with most other classes it is also good to have a strongly typed lists. For this, there is another typedef: typedef DRefs&lt;MyAccount, Account&gt; Refs</p>
<p>which enables you to access class methods and properties directly, via index: </p>
<div class="fragment"><pre class="fragment">MyAccount::Refs accountList;
accountList.append(account);
accountList[0]-&gt;Login();
</pre></div><p>So, for future reference, all derived SkypeKit classes, except your derived <a class="el" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a> class, should start with these two typedefs, like this:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>MyAccount : <span class="keyword">public</span> <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>
{
<span class="keyword">public</span>:
  <span class="keyword">typedef</span> DRef&lt;MyAccount, Account&gt; Ref;
  <span class="keyword">typedef</span> DRefs&lt;MyAccount, Account&gt; Refs;
  ...
};
</pre></div><p>Now back to our login sequence:</p>
<p>The GetAccount() returns a bool value, indicating whether the account object retrieval was successful. If so, the second argument will return with a reference to a valid account object.</p>
<p>To log in, we call the Account::LoginWithPassword(MyPassword), like this: </p>
<div class="fragment"><pre class="fragment"><a name="_a3"></a><a class="code" href="class_s_e_string.html" title="SEString is basic char* based string class.">SEString</a> accountPsw = <span class="stringliteral">&quot;yourpasswordhere&quot;</span>;
account-&gt;LoginWithPassword(accountPsw, <span class="keyword">false</span>, <span class="keyword">false</span>);
</pre></div><p>The first of the two boolean arguments specifies whether the supplied password will be saved in the local database (so that for subsequent logins we can use Login instead of LoginWithPassword). Passing false to the second argument prevents all updates to the local database, which makes sense for preliminary testing purposes.</p>
<p>So we're all logged in now, right? Wrong! As you probably know from using standard <a class="el" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a> clients, account login is not instantaneous. <a class="el" href="class_account.html#a7a4e0b545f06ce75bc95c6a0d6f0c14e">Account::LoginWithPassword</a> only initiates the login process. It is asynchronous -- that is, the call returns after immediately making the request. So, how will we know the login was successful?</p>
<p>We do this by catching the account's status property change event. To do that, we derive our own account class, like this:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>MyAccount : <span class="keyword">public</span> <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>
{
<span class="keyword">public</span>:
  <span class="keyword">typedef</span> DRef&lt;MyAccount, Account&gt; Ref;
  <span class="keyword">typedef</span> DRefs&lt;MyAccount, Account&gt; Refs;
  <span class="keywordtype">bool</span> loggedIn;
  <span class="keywordtype">bool</span> loggedOut;
  MyAccount(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> oid, SERootObject* root);
  <span class="keywordtype">void</span> OnChange(<span class="keywordtype">int</span> prop);
};

MyAccount::MyAccount(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> oid, SERootObject* root) : <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>(oid, root) 
{
  loggedIn = <span class="keyword">false</span>;
  loggedOut = <span class="keyword">false</span>;
};

<span class="keywordtype">void</span> MyAccount::OnChange(<span class="keywordtype">int</span> prop)
{
  <span class="keywordflow">if</span> (prop == <a name="a4"></a><a class="code" href="class_account.html#a0e7af48c2ba1d22690d83f5adbc071c5a61a8b512c81fd58cbcd6ea8f9e8d54af">Account::P_STATUS</a>)
  {
    <a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90d">Account::STATUS</a> loginStatus;
    this-&gt;GetPropStatus(loginStatus);
    <span class="keywordflow">if</span> (loginStatus == <a name="a5"></a><a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90dac2c5c7998621e577285e6c4517a897bd">Account::LOGGED_IN</a>)
    {
      printf(<span class="stringliteral">&quot;Login complete.\n&quot;</span>);
      loggedIn = <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loginStatus == <a name="a6"></a><a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90dac506fb36d2c2004e4f9abe5c64941c3d">Account::LOGGED_OUT</a>)
    {
      <a class="code" href="class_account.html#a95e00750213e0d22767114228db1e261">Account::LOGOUTREASON</a> whyLogout;
      this-&gt;GetPropLogoutreason(whyLogout);
      printf(<span class="stringliteral">&quot;%s\n&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)tostring(whyLogout));

      loggedOut = <span class="keyword">true</span>;
      printf(<span class="stringliteral">&quot;Logout complete.\n&quot;</span>);
    };
  };
};
</pre></div><p>Note that there are no separate events for different account properties. This callback will fire for all property changes. loggedIn and loggedOut are declared in global scope so that we can quickly access them in our main loop, without requesting the property values from wrapper cache each iteration.</p>
<p>Unfortunately, overriding our own <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a> class is not quite enough. The reason is that the wrapper objects are normally created somewhat spontaneously. For example, in case of an incoming chat message, a corresponding object is created automatically. If we had our own class for chat messages, how would <a class="el" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a> know which class to instantiate? For this, the skype class has a set of overridable newXXX(int oid) methods. In this case, we override the newAccount method so that it returns MyAccount instead of <a class="el" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>MySkype : <span class="keyword">public</span> <a class="code" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a>
{
<span class="keyword">public</span>:
  <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>* <a name="a7"></a><a class="code" href="class_skype.html#a3f609b824744b88ec82b47e460116b92">newAccount</a>(<span class="keywordtype">int</span> oid) { <span class="keywordflow">return</span> <span class="keyword">new</span> MyAccount(oid, <span class="keyword">this</span>);}
};
</pre></div><p>After all this, our "main loop" looks simple:</p>
<div class="fragment"><pre class="fragment">MyAccount::Ref account;
<span class="keywordflow">if</span> (skype-&gt;GetAccount(accountName, account))
{
  printf(<span class="stringliteral">&quot;Logging in..\n&quot;</span>);
  account-&gt;LoginWithPassword(accountPsw, <span class="keyword">false</span>, <span class="keyword">false</span>);
  <span class="keywordflow">while</span> ( (!account-&gt;loggedIn) &amp;&amp; (!account-&gt;loggedOut) ) { Delay(1); }; 

  <span class="keywordflow">if</span> (account-&gt;loggedIn)
  {
    printf(<span class="stringliteral">&quot;Press ENTER to log out..\n&quot;</span>);
    <span class="keywordtype">int</span> ch = getchar();
  };

  printf(<span class="stringliteral">&quot;Logging out..\n&quot;</span>);
  account-&gt;Logout(<span class="keyword">false</span>);
  <span class="keywordflow">while</span> (!account-&gt;loggedOut) { Delay(1); }; <span class="comment">// Loop until LoggedOut</span>
}
<span class="keywordflow">else</span>
{
  printf(<span class="stringliteral">&quot;Account does not exist\n&quot;</span>);
};
</pre></div><p>All we need to do now is the clean-up sequence: </p>
<div class="fragment"><pre class="fragment">    skype-&gt;stop();
    <span class="keyword">delete</span> skype;
</pre></div><h2><a class="anchor" id="Step1FullCode"></a>
Full code of this example</h2>
<div class="fragment"><pre class="fragment"><span class="comment">/****************************************************************************</span>
<span class="comment"></span>
<span class="comment">Getting Started With SkypeKit. Tutorial Application, Step 1.</span>
<span class="comment"></span>
<span class="comment">In this exercise, we&#39;ll examine a program that</span>
<span class="comment"> 1. Takes a username and password as command-line arguments</span>
<span class="comment"> 2. Initiates login with that username</span>
<span class="comment"> 3. Waits until the login process is complete</span>
<span class="comment"> 4. Waits for user to press Enter and initiates logout</span>
<span class="comment"> 5. Waits until logout is complete</span>
<span class="comment"> 6. Cleans up and exits</span>
<span class="comment">**/</span>

<span class="preprocessor">#include &quot;<a class="code" href="skype-embedded__2_8h.html">skype-embedded_2.h</a>&quot;</span>
<span class="preprocessor">#include &quot;keypair.h&quot;</span>

<span class="preprocessor">#ifdef _WIN32</span>
<span class="preprocessor"></span><span class="preprocessor">#include &quot;Windows.h&quot;</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="keyword">using namespace </span>Sid;

<span class="comment">// Parameters for the transport.</span>
<a class="code" href="class_s_e_string.html" title="SEString is basic char* based string class.">SEString</a>  inetAddr  = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;
uint      portNum   = 8963;

<span class="keywordtype">void</span> Delay(<span class="keywordtype">int</span> Sec)
{
<span class="preprocessor">  #ifdef _WIN32</span>
<span class="preprocessor"></span>    Sleep(Sec * 1000);
<span class="preprocessor">  #else</span>
<span class="preprocessor"></span>    sleep(Sec);
<span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>};


<span class="comment">//----------------------------------------------------------------------------</span>
<span class="comment">// Interface section</span>

<span class="keyword">class </span>MyAccount : <span class="keyword">public</span> <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>
{
<span class="keyword">public</span>:
  <span class="comment">// The purpose of these typedef&#39;s is to enable us to delclare reference variables as:</span>
  <span class="comment">// MyAccount::Ref someAccount</span>
  <span class="comment">// MyAccount::Refs someAccountList</span>
  <span class="keyword">typedef</span> DRef&lt;MyAccount, Account&gt; Ref;
  <span class="keyword">typedef</span> DRefs&lt;MyAccount, Account&gt; Refs;

  <span class="comment">// Simple globals for the main loop. We set those two bools from within</span>
  <span class="comment">// OnChange callback, checking for Account status property changes.</span>
  <span class="keywordtype">bool</span> loggedIn;
  <span class="keywordtype">bool</span> loggedOut;

  MyAccount(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> oid, SERootObject* root);
  <span class="keywordtype">void</span> OnChange(<span class="keywordtype">int</span> prop);
};

<span class="keyword">class </span>MySkype : <span class="keyword">public</span> <a class="code" href="class_skype.html" title="The main class that exposes Skype-related functionality to your application. Currently the SDK only s...">Skype</a>
{
<span class="keyword">public</span>:
  <span class="comment">// Every time an account object is created, we will return instance of MyAccount.</span>
  <span class="comment">// This basically &quot;registers&quot; our new MyAccount class as the new Account class.</span>
  <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>* newAccount(<span class="keywordtype">int</span> oid) { <span class="keywordflow">return</span> <span class="keyword">new</span> MyAccount(oid, <span class="keyword">this</span>);}
};

<span class="comment">//----------------------------------------------------------------------------</span>
<span class="comment">// Implementation section</span>


MyAccount::MyAccount(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> oid, SERootObject* root) : <a class="code" href="class_account.html" title="Represents a local account. Encapsulates methods for Skype account creation, login and logout as well...">Account</a>(oid, root) 
{
  loggedIn = <span class="keyword">false</span>;
  loggedOut = <span class="keyword">false</span>;
};

<span class="comment">// There are no separate events for different account properties -</span>
<span class="comment">// this callback will fire for all property changes.</span>

<span class="keywordtype">void</span> MyAccount::OnChange(<span class="keywordtype">int</span> prop)
{
  <span class="comment">// Here we are swicthing loggedIn and loggedOut bools to inform our </span>
  <span class="comment">// &quot;main loop&quot; of the account status changes.</span>

  <span class="keywordflow">if</span> (prop == <a class="code" href="class_account.html#a0e7af48c2ba1d22690d83f5adbc071c5a61a8b512c81fd58cbcd6ea8f9e8d54af">Account::P_STATUS</a>)
  {
    <span class="comment">// OnChange callback does not directly give you the new value</span>
    <span class="comment">// for the property that changed. You will need to explicitly</span>
    <span class="comment">// retrieve the new value.</span>
    <a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90d">Account::STATUS</a> loginStatus;
    this-&gt;GetPropStatus(loginStatus);
    <span class="keywordflow">if</span> (loginStatus == <a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90dac2c5c7998621e577285e6c4517a897bd">Account::LOGGED_IN</a>)
    {
      printf(<span class="stringliteral">&quot;Login complete.\n&quot;</span>);
      loggedIn = <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (loginStatus == <a class="code" href="class_account.html#ac2cd2fd3f85a302363a51db3ba97c90dac506fb36d2c2004e4f9abe5c64941c3d">Account::LOGGED_OUT</a>)
    {
      <span class="comment">// Account can proceed to LOGGED_OUT not only on because of intentional logout.</span>
      <span class="comment">// This state is also reached by failure conditions, such as invalid password, etc.</span>
      <span class="comment">// For this reason, it makes sense to also check the value of Account::P_LOGOUTREASON</span>
      <span class="comment">// property.</span>
      <a class="code" href="class_account.html#a95e00750213e0d22767114228db1e261">Account::LOGOUTREASON</a> whyLogout;
      this-&gt;GetPropLogoutreason(whyLogout);

      <span class="comment">// The tostring function conveniently converts an SkypeKit enum value</span>
      <span class="comment">// to an SEString in following format: &lt;Class&gt;::&lt;ENUMERATOR&gt;.&lt;ENUM&gt;</span>
      <span class="comment">// For example: &quot;Account::LOGOUTREASON.INCORRECT_PASSWORD&quot;</span>
      printf(<span class="stringliteral">&quot;%s\n&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)tostring(whyLogout));

      loggedOut = <span class="keyword">true</span>;
      printf(<span class="stringliteral">&quot;Logout complete.\n&quot;</span>);
    };
  };
};


<span class="comment">//----------------------------------------------------------------------------</span>
<span class="comment">// Main</span>

MySkype* skype = 0;

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])
{
  printf(<span class="stringliteral">&quot;*****************************************************************\n&quot;</span>);
  printf(<span class="stringliteral">&quot; SkypeKit Tutorial, Step 1 - Login with skypename and password.\n&quot;</span>);
  printf(<span class="stringliteral">&quot;*****************************************************************\n&quot;</span>);

  <span class="keywordflow">if</span> (argc &lt; 3)
  {
    printf(<span class="stringliteral">&quot;usage: tutorial_1 &lt;skypename&gt; &lt;password&gt;\n&quot;</span>);
    <span class="keywordflow">return</span> 0;
  };

  <a class="code" href="class_s_e_string.html" title="SEString is basic char* based string class.">SEString</a> accountName  = argv[1];
  <a class="code" href="class_s_e_string.html" title="SEString is basic char* based string class.">SEString</a> accountPsw   = argv[2];

  <span class="comment">// At this point the SDK runtime should be already up and running.</span>
  printf(<span class="stringliteral">&quot;Creating skype ..\n&quot;</span>);
  skype = <span class="keyword">new</span> MySkype();

  <span class="comment">// Retrieving the keypair and starting up the Skype instance</span>
  getKeyPair ();
  skype-&gt;init(keyBuf, inetAddr, portNum, <span class="stringliteral">&quot;streamlog.txt&quot;</span>);
  skype-&gt;start();

  printf(<span class="stringliteral">&quot;Getting account ..\n&quot;</span>);

  MyAccount::Ref account;

  <span class="keywordflow">if</span> (skype-&gt;GetAccount(accountName, account))
  {
    printf(<span class="stringliteral">&quot;Logging in..\n&quot;</span>);
    account-&gt;LoginWithPassword(accountPsw, <span class="keyword">false</span>, <span class="keyword">false</span>);

    <span class="comment">// Loop until LoggedIn or login failure</span>
    <span class="keywordflow">while</span> ( (!account-&gt;loggedIn) &amp;&amp; (!account-&gt;loggedOut) ) { Delay(1); }; 

    <span class="keywordflow">if</span> (account-&gt;loggedIn)
    {
      printf(<span class="stringliteral">&quot;Press ENTER to log out..\n&quot;</span>);
      getchar();
    };

    printf(<span class="stringliteral">&quot;Logging out..\n&quot;</span>);
    account-&gt;Logout(<span class="keyword">false</span>);

    <span class="keywordflow">while</span> (!account-&gt;loggedOut) { Delay(1); }; <span class="comment">// Loop until LoggedOut</span>
  }
  <span class="keywordflow">else</span>
  {
    printf(<span class="stringliteral">&quot;Account does not exist\n&quot;</span>);
  };

  printf(<span class="stringliteral">&quot;Cleaning up.\n&quot;</span>);
  skype-&gt;stop();
  <span class="keyword">delete</span> skype;
  printf(<span class="stringliteral">&quot;Done.\n&quot;</span>);
  <span class="keywordflow">return</span> 0;
};
</pre></div> </div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<hr/>	
		<p><b>(c) Skype Technologies S.A. Confidential/Proprietary</b></p>		
		<p>Last updated: Fri Oct 7 2011</p>		
		</BODY>
</HTML>
