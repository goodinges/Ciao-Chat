<project basedir="." default="main" name="sid-java-wrapper">

    <property name="build.dir" value="${basedir}/bin" />
    <property name="api.dir" value="${basedir}" />
    <property name="ipc.dir" value="${basedir}/../../../../ipc/java" />

    <property name="target.dir" value="." />

    <target name="help">
        <echo>SkypeKit java wrapper build. Available targets:</echo>
        <echo>    help:         Display this help.</echo>
        <echo>    clean:        Removes files generated by other targets.</echo>
        <echo>    compile:      Compiles api and ipc classes</echo>
        <echo>    jar:          Packages source and class files into jar library.</echo>
        <echo>    clean-build:  Removes all previous files and builds the jar library.</echo>
        <echo>    main:         Default target. Does a clean build</echo>
        <echo/>
        <echo>Android releated targets:</echo>
        <echo>    compile-android-debug:    Compile classes in debug mode.</echo>
        <echo>    compile-android-release:  Complile classes in release mode.</echo>
        <echo>    jar-android-debug:        Package classes into debug library.</echo>
        <echo>    jar-android-release:      Package classes into release library.</echo>
        <echo>    android-debug:            Top-level target for building debug library.</echo>
        <echo>    android-release:          Top-level target for building release library.</echo>
    </target>

    <target name="clean">
        <delete dir="${build.dir}"/>
    </target>

    <target name="compile">
        <mkdir dir="${build.dir}"/>
        <javac sourcepath="" debug="true" destdir="${build.dir}" includeAntRuntime="false">
            <src path="${api.dir};${ipc.dir}"/>
	    <exclude name="**/LocalSocketTransport.java"/>
	    <exclude name="**/SkypeKitRunner.java"/>
	    <exclude name="**/SkypeKitStartOptions.java"/>
	</javac>
    </target>

    <target name="jar" depends="compile">
        <jar destfile="sid-java-wrapper.jar">
			<fileset dir="${build.dir}" />
			<fileset dir="${api.dir}"
				includes="**/*.java"
			/>
			<fileset dir="${ipc.dir}"
				includes="**/*.java"
			    excludes="**/LocalSocketTransport.java,**/SkypeKitRunner.java"
			/>
		</jar>
	</target>
	
    <target name="clean-build" depends="clean,jar"/>

    <target name="main" depends="clean-build"/>

    <!-- Android -->

    <!-- target to compile the debug version -->
    <target name = "compile-android-debug">
        <mkdir dir = "${build.dir}"/>
        <javac debug = "true"
               destdir = "${build.dir}"
               includeAntRuntime = "false"
               classpath = "${android-sdk}"
               excludes = "**/Base64.java **/BaseX.java **/SkypeKeyManager.java **/TLSTransport.java"
               verbose = "yes">
            <src path = "${api.dir};${ipc.dir}"/>
		</javac>
    </target>

    <!-- target to compile the release version -->
    <target name = "compile-android-release">
        <mkdir dir = "${build.dir}"/>
        <javac debug = "false"
               destdir = "${build.dir}"
               includeAntRuntime = "false"
               classpath = "${android-sdk}"
               excludes = "**/Base64.java **/BaseX.java **/SkypeKeyManager.java **/TLSTransport.java"
               verbose = "yes">
            <src path="${api.dir};${ipc.dir}"/>
		</javac>
    </target>

    <!-- target to package debug java wrapper jar library -->
    <target name="jar-android-debug" depends="compile-android-debug">
        <jar destfile="${target.dir}/skypekit-debug.jar" manifest="Manifest.txt">
            <fileset dir="${build.dir}"/>
            <fileset dir="${api.dir}" includes="**/*.java"/>
            <fileset dir="${ipc.dir}"
                includes = "**/*.java"
                excludes = "**/Base64.java **/BaseX.java **/SkypeKeyManager.java **/TLSTransport.java" />
        </jar>
    </target>

    <!-- target to package release java wrapper jar library -->
    <target name="jar-android-release" depends="compile-android-release">
        <jar destfile="${target.dir}/skypekit.jar" manifest="Manifest.txt">
            <fileset dir="${build.dir}"/>
        </jar>
    </target>

    <!-- top level target for debug version of android java wrapper -->
    <target name="android-debug" depends="clean,create-manifest,jar-android-debug"/>

    <!-- top level target for release version of android java wrapper -->
    <target name="android-release" depends="clean,create-manifest,jar-android-release"/>

    <!-- target to create custom jar manifest source -->
    <target name="create-manifest">
        <echo file="Manifest.txt">Implementation-Version: ${build.id}</echo>
    </target>
</project>
